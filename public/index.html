<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CMD - Thanh Nguyên</title>
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Source Code Pro', monospace;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(270deg, #ff9a9e, #fad0c4, #a1c4fd, #c2e9fb, #fbc2eb, #a6c1ee);
      background-size: 1200% 1200%;
      animation: gradientShift 25s ease infinite;
      padding: 1rem;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .console-box {
      max-width: 600px;
      width: 100%;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      backdrop-filter: blur(12px);
      background: rgba(20, 20, 20, 0.85);
      display: flex;
      flex-direction: column;
      height: 90vh;
    }

    .console-header {
      display: flex;
      align-items: center;
      background: #2b2b2b;
      padding: 0.5rem 0.75rem;
    }
    .window-controls { display: flex; gap: 0.5rem; }
    .dot {
      width: 14px; height: 14px; border-radius: 50%;
      transition: transform .2s ease;
    }
    .dot:hover { transform: scale(1.3); }
    .dot.red { background: #ff605c; }
    .dot.yellow { background: #ffbd44; }
    .dot.green { background: #00ca4e; }
    .console-title {
      margin-left: 0.75rem;
      font-size: 1rem;
      font-weight: 500;
      color: #fff;
    }

    .console-body {
      background: #0a0a0a;
      color: #0f0;
      flex: 1;
      padding: 0.75rem;
      font-size: 1rem;
      line-height: 1.5em;
      white-space: pre-wrap;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #444 #0a0a0a;
    }
    .console-body::-webkit-scrollbar { width: 8px; }
    .console-body::-webkit-scrollbar-track { background: #0a0a0a; }
    .console-body::-webkit-scrollbar-thumb { background-color: #444; border-radius: 4px; }
    .console-body::-webkit-scrollbar-thumb:hover { background-color: #666; }

    .console-footer {
      background: #2b2b2b;
      padding: 0.5rem 0.75rem;
    }
    .console-footer input {
      width: 100%;
      padding: 0.75rem;
      border: none;
      outline: none;
      border-radius: 8px;
      background: #111;
      color: #ffffff;
      font-family: 'Source Code Pro', monospace;
      font-size: 1rem;
    }

    .log-line {
      margin: 0;
      padding: 0;
      font-size: 1rem !important;
      line-height: 1.5em !important;
      word-break: break-word;
    }
    .log-line.cmd    { color: #7dd3fc; }
    .log-line.error  { color: #f87171; }
    .log-line.output { color: #ffffff; }
    .log-line.system { color: #facc15; }
    .log-line.special{ color: #c084fc; }

    @media (max-width: 400px) {
      .console-title { font-size: 0.9rem; }
      .console-footer input { font-size: 0.9rem; padding: 0.6rem; }
      .log-line { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <div class="console-box">
    <div class="console-header">
      <div class="window-controls">
        <div class="dot red"></div>
        <div class="dot yellow"></div>
        <div class="dot green"></div>
      </div>
      <div class="console-title">&gt;_ Thanh Nguyên</div>
    </div>

    <div id="terminal" class="console-body"></div>

    <div class="console-footer">
      <input id="cmdInput" placeholder="Nhập lệnh (ví dụ: dir hoặc ls)..." />
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const terminal = document.getElementById("terminal");
    const input = document.getElementById("cmdInput");

    let history = [];
    let historyIndex = -1;
    let currentPath = "C:\\Storage";

    function printLine(text, cls = "") {
      const lines = text.split("\n").filter(t => t.trimEnd());
      const fragment = document.createDocumentFragment();
      lines.forEach(line => {
        const div = document.createElement("div");
        div.className = "log-line " + cls;
        div.textContent = line;
        fragment.appendChild(div);
      });
      terminal.appendChild(fragment);
      terminal.scrollTop = terminal.scrollHeight;
    }

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        const cmd = input.value.trim();
        if (cmd !== "") {
          printLine(`${currentPath}> ${cmd}`, "cmd");
          socket.emit("command", cmd);
          history.push(cmd);
          historyIndex = history.length;
        }
        input.value = "";
      } else if (e.key === "ArrowUp") {
        if (historyIndex > 0) {
          historyIndex--;
          input.value = history[historyIndex] || "";
          setTimeout(() => input.setSelectionRange(input.value.length, input.value.length), 0);
        }
        e.preventDefault();
      } else if (e.key === "ArrowDown") {
        if (historyIndex < history.length - 1) {
          historyIndex++;
          input.value = history[historyIndex] || "";
        } else {
          historyIndex = history.length;
          input.value = "";
        }
        e.preventDefault();
      }
    });

    socket.on("output", (data) => {
      data.split("\n").forEach(line => {
        const t = line.trimEnd();
        if (t) {
          let cls = "";
          if (/error|failed|not found|cannot/i.test(t)) cls = "error";
          else if (/exited with code/i.test(t)) cls = "system";
          else if (/\.txt|\.js|\.json|dir:/i.test(t)) cls = "special";
          else cls = "output";
          printLine(t, cls);
        }
      });
    });

    socket.on("current_path", (path) => {
      currentPath = path;
    });

    socket.on("nano_open", (data) => {
      window.open(`/nano.html?file=${encodeURIComponent(data.file)}`, '_blank');
    });
  </script>
</body>
          </html>
